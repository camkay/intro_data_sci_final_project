---
title             : "Something Clever..."
shorttitle        : "Title"

author: 
  - name          : "Cameron S. Kay"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "1451 Onyx Street, Eugene, OR 97403"
    email         : "ckay@uoregon.edu"
  - name          : "Stefania R. Ashby"
    affiliation   : "1"
  - name          : "Ashley L. Miller"
    affiliation   : "1"

affiliation:
  - id            : "1"
    institution   : "University of Oregon"

abstract: |
  TBD
  
keywords          : "american, social media, internet, pew research center"

bibliography      : ["r-references.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : no
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
# knit settings
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      fig.width = 6.5,
                      fig.height = 8.0)

# turn off scientific notation
options(scipen = 999) 

# if you do not have the following packages, you will need to install them
#install.packages("papaja")
#install.packages("tidyverse")
#install.packages("lme4")
#install.packages("lmerTest")
#install.packages("here")
#install.packages("rio")
#install.packages("lubridate")
#install.packages("cowplot")
#install.packages("wesanderson")
#install.packages("forcats")
#install.packages("pander")
#install.packages("magrittr")
#install.packages("Hmisc")

# load required libraries
library(papaja)
library(tidyverse)
library(lme4)
library(lmerTest)
library(here)
library(rio)
library(lubridate)
library(cowplot)
library(wesanderson)
library(forcats)
library(pander)
library(magrittr)
library(Hmisc)

# Load required functions
source(here::here("functions", "numbers2words.R")) #writes out a number; found on github from James Fox (https://github.com/ateucher/useful_code/blob/master/R/numbers2words.r)
source(here::here("functions", "perble.R")) #creates a table but with percentages
source(here::here("functions", "spround.R")) #combines round and sprintf
```


```{r prep_data, include = FALSE}
# import data
df <- import(here::here("data", "dataSPSS.sav"), setclass = "tibble") %>%
  janitor::clean_names()

# characterize all columns except for age and books1 (the spss labels were causing the numeric values to be recorded as NAs for those columns)
df %<>%
  mutate_at(vars(-age, -books1), characterize)

#switch 99 ages with refused
df %<>%
  mutate(age = replace(age, age == 99, NA))

# select only variables of interest
df_td <- df %>% 
  select(-comp, 
         -state:-qs1,
         -intmob,
         -home4nw:-device1d,
         -web1f:-web1h, #dropped because we don't have frequency values
         -pial5a:-pial5d,
         -pial11a:-pial11_igbm,
         -marital:-racem4,
         -birth_hisp,
         -partyln:-cellweight) %>%
  # parse date for interview date column
  mutate(int_date = ymd(int_date)) %>% 
  # remove participants who do not occasionally use the internet or email
  filter(eminuse == "Yes") %>%
  select(-eminuse)
  
# over-gather the sns_use and sns_freq_use columns, and spread them back out
df_td %<>%
  gather(key = "websites", value = "value", starts_with("sns"), starts_with("web")) %>%
  separate(websites, into = c("temp", "website"), sep = "[[:digit:]]") %>%
  spread(key = "temp", value = "value")

# change "no, do not do this" in the sns_use column to "Rarely if ever" in the sns_freq_use columns
df_td[which(df_td[, "web"] == "No, do not do this"), "sns"] <- "Rarely if ever"

#drop now unneeded sns_use column
df_td %<>%
  select(-web) %>% 
  #rename the values in the website column
  mutate(website = recode(website, a = "Twitter",
                                   b = "Instagram",
                                   c = "Facebook",
                                   d = "Snapchat",
                                   e = "YouTube")) %>% 
  #rename poorly named columns for sanity
  rename(id = respid,
         date = int_date,
         int_use_freq = intfreq,
         int_good_society = pial11,
         int_good_self = pial12,
         total_books_read = books1,
         books_print = books2a,
         books_audio = books2b,
         books_elect = books2c,
         race = racecmb,
         income = inc,
         sns_freq_use = sns,
         sns = website) %>% 
#convert factors to factors
  mutate(books_print = factor(books_print),
         books_audio = factor(books_audio),
         books_elect = factor(books_elect),
         sex = factor(sex),
         race = factor(race),
         party = factor(party),
         sns = factor(sns),
         int_good_society = factor(int_good_society),
         int_good_self = factor(int_good_self),
         int_use_freq = factor(int_use_freq),
         sns_freq_use = factor(sns_freq_use)) %>% 
  mutate(int_good_self    = fct_recode(int_good_self,
                                       "Bad" = "Bad thing",
                                       "Good" = "Good thing",
                                       "Some of both" = "(VOL) Some of both",
                                       "Other" = "(VOL) Don't know",
                                       "Other" = "(VOL) Refused"),
         int_good_society = fct_recode(int_good_society,
                                       "Bad" = "Bad thing",
                                       "Good" = "Good thing",
                                       "Some of both" = "(VOL) Some of both",
                                       "Other" = "(VOL) Don't know",
                                       "Other" = "(VOL) Refused"),
         party            = fct_recode(party,
                                       "Other" = "(VOL) Other party",
                                       "Other" = "(VOL) Don't know",
                                       "Other" = "(VOL) No preference",
                                       "Refused" = "(VOL) Refused"),
         race             = fct_recode(race,
                                       "Asian" = "Asian or Asian-American",
                                       "Black" = "Black or African-American",
                                       "Other" = "Or some other race",
                                       "Mixed" = "Mixed Race")) %>% 
  mutate(int_good_society = factor(int_good_society, 
                                   levels = c("Other", 
                                               "Bad", 
                                               "Some of both", 
                                               "Good")),
         int_good_self    = factor(int_good_self, 
                                   levels = c("Other", 
                                              "Bad", 
                                              "Some of both", 
                                              "Good")),
         int_use_freq     = factor(int_use_freq, 
                                   levels = c("(VOL) Don't know", 
                                              "Less often?", 
                                              "Several times a week, OR", 
                                              "About once a day", 
                                              "Several times a day", 
                                              "Almost constantly")),
         sns_freq_use     = factor(sns_freq_use,
                                   levels = c("(VOL) Don't know",
                                              "Rarely if ever",
                                              "Less often",
                                              "Every few weeks",
                                              "A few times a week", 
                                              "About once a day", 
                                              "Several times a day")))


```

A common definition for a social media site is that it is an internet-based service allowing for the creation and broadcast of user-generated information [@Boyd2008; @Kaplan2010; @Obar2015]. @Obar2015 emphasize the user-generated aspect of this definition, arguing that this content is the lifeblood of social media. Although that may sound hyperbolic, it logically follows that if a site is created with the express purpose of providing user-generated content, it must have user-generated content to function as intended. By way of illustration, without videos created by users, YouTube, a social media site that allows its users to upload and share videos, would fail to serve its primary purpose. Netflix, a site that allows users to only stream videos, does not require user-generated content, as it does not serve user-generated content, and, by extension is not a social media site. Beyond the functional aspects of social media sites, the user-generated focus also highlights the importance of individual differences in the user-service relationship, as users invariably have characteristics that affect how they consume and generate content.

# Methods

The data for the current study was collected by the @Pew.

## Participants

`r capitalize(.numbers2words(nrow(df)))` people were surveyed by telephone (`r .spround(.perble(df$sample)["Percent", "Cell phone"])`% cell phone; `r .spround(.perble(df$sample)["Percent", "Landline"])`% landline) over a period of `r interval(min(df_td$date), max(df_td$date)) %/% days(1)` days in `r unique(months(df_td$date))` of `r unique(year(df_td$date))`. We excluded any participants who reported that they do not even occasionally use the internet or email (*n* = `r nrow(df) - length(unique(df_td$id))`). The resulting sample comprised `r length(unique(df_td$id))` people (`r .spround(.perble(df_td$sex)["Percent", "Female"])`% female). Ages ranged from `r min(df_td$age, na.rm = TRUE)` to `r max(df_td$age, na.rm = TRUE)` (*M* age = `r .spround(mean(df_td$age, na.rm = TRUE))`; *SD* age = `r .spround(sd(df_td$age, na.rm = TRUE))`)\footnote{Note that the descriptive statistics for age are slightly lower than reality. Ages 97 and older were recorded as simply 97 in the data.}. Concerning race, `r .spround(.perble(df_td$race)["Percent", "White"])`% identified as white, `r .spround(.perble(df_td$race)["Percent", "Black"])`% identified as black, `r .spround(.perble(df_td$race)["Percent", "Asian"])`% identified as Asian, `r .spround(.perble(df_td$race)["Percent", "Mixed"])`% identified as mixed race, and `r .spround(.perble(df_td$race)["Percent", "Don't know/Refused (VOL.)"] + .perble(df_td$race)["Percent", "Other"])`% refused to answer or reported being from some other race.  

## Material

## Procedure

## Data analysis
We used `r cite_r("r-references.bib")` for all our analyses.


# Results

```{r books_analyses_viz, include = FALSE}

# Examine whether age trends in reading differs as a function of book format 
# (e.g. do older readers spend more time with paper copy books whereas younger users may spend more time with audiobooks or digital print?). 

# Subset the original data and tidy for plotting
plot_data <- df_td %>% 
  select(age, total_books_read, books_print, books_audio, books_elect) %>% 
  gather(book_format, yn, -age, -total_books_read) %>% 
  separate(book_format, c("dis", "book_format"), sep = "_", convert = TRUE) %>% 
  select(-dis) %>% 
  filter(!is.na(yn) & !str_detect(yn, "VOL")) %>% 
  mutate(book_format = factor(book_format),
         yn = factor(yn)) 

####

# Bar Chart: looking at average books read across age.
bar_plot <- plot_data %>% 
  group_by(age) %>% 
  dplyr::summarize(mean_books = mean(total_books_read)) %>% 
  ggplot(aes(x = age, y = mean_books, fill = age)) + 
  geom_col() +
  scale_fill_viridis_c() + 
  theme(legend.position = "none") +
  labs(y = "Average Books Read",
       x = "Age",
       title = "Average Number of Books Read by Age",
       subtitle = "Books Read in the Past Year. Respondents 18-99.") +
  theme(plot.subtitle = element_text(size = 11, hjust = 0, face = "italic", color = "black"),
        plot.title = element_text(size = 15, hjust = 0))

bar_plot



# Bar Chart: Average books read by format
bar_plot2 <- plot_data %>% 
  group_by(age, book_format) %>% 
  dplyr::summarize(mean_books = mean(total_books_read)) %>% 
  ggplot(aes(x = age, y = mean_books, fill = book_format)) + 
  geom_col() +
  facet_wrap(~book_format, nrow = 3, ncol = 1) +
  theme(legend.position = "none") +
  labs(y = "Average Books Read",
       x = "Age",
       title = "Average Books Read by Format",
       subtitle = "Average Books Read in the Past Year. Respondents 18-99.") +
  theme(plot.subtitle = element_text(size = 11, hjust = 0, face = "italic", color = "black"),
        plot.title = element_text(size = 15, hjust = 0))

bar_plot2

## Scatter Plots: 
# Total books read by format
point_plot <- plot_data %>% 
  filter(yn == 'Yes') %>% 
  group_by(age, book_format) %>% 
  count(yn) %>% 
  ggplot(aes(x = age, y = n)) + 
  geom_point() +
  geom_smooth(method = 'lm') +
  facet_wrap(~book_format, nrow = 3, ncol = 1) +
  theme(legend.position = "none") +
  labs(y = "Total Books Read",
       x = "Age",
       title = "Total Books Read by Format",
       subtitle = "Total Books Read in the Past Year. Respondents 18-99.") +
  theme(plot.subtitle = element_text(size = 11, hjust = 0, face = "italic", color = "black"),
        plot.title = element_text(size = 15, hjust = 0))

point_plot

# Average books read by format
point_plot2 <- plot_data %>% 
  group_by(age, book_format) %>% 
  dplyr::summarize(mean_books = mean(total_books_read)) %>% 
  ggplot(aes(x = age, y = mean_books)) + 
  geom_point() +
  geom_smooth(method = 'lm',
              aes(color = book_format)) +
  scale_color_manual(values = wes_palette("Darjeeling1")) +
  facet_wrap(~book_format, nrow = 3, ncol = 1) +
  theme(legend.position = "none") +
  labs(y = "Average Books Read",
       x = "Age",
       title = "Average Books Read by Format",
       subtitle = "Average Books Read in the Past Year. Respondents 18-99.") +
  theme(plot.subtitle = element_text(size = 11, hjust = 0, face = "italic", color = "black"),
        plot.title = element_text(size = 15, hjust = 0))

point_plot2

# Regression model to see how age and format of books relates to average number of books read. 
reg_data <- plot_data %>%
  group_by(age, book_format) %>% 
  dplyr::summarize(mean_books = mean(total_books_read))

model <- lm(mean_books ~ age * book_format, data = reg_data)
model

# Put anova of regression model into a table
pander(anova(model))


```


```{r ash_analyses_viz, include = FALSE}

#Examine whether perceptions of social media use vary as age, political party, and social media site

#Prep data

plot_data_ash <- df_td %>% 
  select(age, sex, race, cregion, party, sns, sns_freq_use, int_good_society, int_good_self, int_use_freq)

#FINALLY ready for the first graph:

#Graphing ratings of how good vs bad the internet is for society as a function of political party

plot_ash1 <- plot_data_ash %>%
  mutate(int_good_self = as.numeric(int_good_self),
         int_good_society = as.numeric(int_good_society)) %>%
  filter(party != "Refused") %>%
  group_by(party) %>%
  dplyr::summarize(m_age = mean(age),
            m_self = mean(int_good_self),
            m_society = mean(int_good_society)) %>%
  ggplot(aes(x = party, y = m_society)) +
  geom_col(alpha = 0.5, fill = "turquoise3", color = "turquoise4") +
  geom_hline(yintercept = 3.5) + #Note that this line represents the overall mean
  theme_bw() +
  labs(title = "Ash's Plot 1.",
       subtitle = "Ratings on a 4 point scale of how good or bad the internet is for society as a function of political party",
       x = "Political Party", 
       y = "Mean Rating") +
  coord_cartesian(ylim = c(2.5, 4)) 

plot_ash1

#Graph number 2 data prep:

plot2_data_ash <- plot_data_ash %>%
  mutate(int_good_self = as.numeric(int_good_self),
         int_good_society = as.numeric(int_good_society)) %>%
  select(-party, -age) %>%
  filter(int_use_freq != "(VOL) Don't know",
         race != "Don't know/Refused (VOL.)") %>%
  group_by(cregion, race) %>%
  dplyr::summarize(m_self = mean(int_good_self),
            m_society = mean(int_good_society))

plot2_data_ash <- plot2_data_ash %>%
  mutate(self_vs_society = m_self - m_society)

#Plot comparing ratings between how good the internet is for the self.. 
#relative to how good the internet is for society.. 
#as a funtion of race and region in the US

plot_ash2 <- ggplot(plot2_data_ash, aes(x = race, y = self_vs_society, fill = race)) +
  geom_col(alpha = 0.8) +
  facet_wrap(~cregion, ncol = 4) +
  scale_fill_viridis_d() +
  theme_bw() +
  theme(legend.position = "") +
  labs(title = "Ash's Plot 2.",
       subtitle = "Mean difference in ratings between how good the internet is for the self 
relative to how good the internet is for society as a funtion of race and region in the US",
       x = "Race", 
       y = "Mean rating for self - Mean rating for society")

plot_ash2

#Another plot

plot_ash3 <- plot_data_ash %>%
  mutate(int_good_self = as.numeric(int_good_self),
         int_good_society = as.numeric(int_good_society),
         int_use_freq = as.numeric(int_use_freq),
         sns_freq_use = as.numeric(sns_freq_use)) %>%
  filter(party != "Refused",
         sns_freq_use != "<NA>",
         sns_freq_use != "(VOL) Don't know") %>%
  ggplot(aes(x = age, y = sns_freq_use)) +
  geom_smooth(aes(group = party, colour = party), method = "lm", se = FALSE) +
  facet_wrap(~sns) +
  scale_colour_viridis_d() +
  theme_bw() +
  labs(title = "Ash's Plot 3.",
       subtitle = "The relation between age and frequency of social media use as a function of political party and social media site",
       x = "Age", 
       y = "Frequency of social media use",
       colour = "Political party")

plot_ash3

#Yet another plot

plot_ash4 <- plot_data_ash %>%
  mutate(int_good_self = as.numeric(int_good_self),
         int_good_society = as.numeric(int_good_society),
         int_use_freq = as.numeric(int_use_freq),
         sns_freq_use = as.numeric(sns_freq_use)) %>%
  filter(party != "Refused",
         sns_freq_use != "<NA>",
         sns_freq_use != "(VOL) Don't know") %>%
  ggplot(aes(x = age, y = sns_freq_use)) +
  geom_smooth(aes(group = sex, colour = sex), method = "lm", se = FALSE, lwd = 2) +
  scale_color_manual(values = c("turquoise3", "purple3")) +
  facet_wrap(~sns) +
  theme_bw() +
  labs(title = "Ash and Cam's plot 4.",
       subtitle = "The relation between age and frequency of social media use as a function of gender identity and social media site",
       x = "Age", 
       y = "Frequency of social media use",
       colour = "Gender identity")

plot_ash4

```
 

# Discussion


\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
