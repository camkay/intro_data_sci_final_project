---
title             : "Something Clever..."
shorttitle        : "Title"

author: 
  - name          : "Cameron S. Kay"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "1451 Onyx Street, Eugene, OR 97403"
    email         : "ckay@uoregon.edu"
  - name          : "Stefania R. Ashby"
    affiliation   : "1"
  - name          : "Ashley L. Miller"
    affiliation   : "1"

affiliation:
  - id            : "1"
    institution   : "University of Oregon"

abstract: |
  TBD
  
keywords          : "american, social media, internet, pew research center"

bibliography      : ["r-references.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : no
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
# knit settings
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      fig.width = 6.5,
                      fig.height = 8.0)

# turn off scientific notation
options(scipen = 999) 

# if you do not have the following packages, you will need to install them
#install.packages("car")
#install.packages("papaja")
#install.packages("tidyverse")
#install.packages("lme4")
#install.packages("lmerTest")
#install.packages("here")
#install.packages("rio")
#install.packages("lubridate")
#install.packages("cowplot")
#install.packages("wesanderson")
#install.packages("forcats")
#install.packages("pander")
#install.packages("magrittr")
#install.packages("Hmisc")
#install.packages("jcolors")
#install.packages("sjstats")
#install.packages("emmeans")

# load required libraries
library(car)
library(papaja)
library(tidyverse)
library(lme4)
library(lmerTest)
library(here)
library(rio)
library(lubridate)
library(cowplot)
library(wesanderson)
library(forcats)
library(pander)
library(magrittr)
library(Hmisc)
library(jcolors)
library(sjstats)
library(emmeans)

# Load required functions
source(here::here("functions", "numbers2words.R")) #writes out a number; found on github from James Fox (https://github.com/ateucher/useful_code/blob/master/R/numbers2words.r)
source(here::here("functions", "perble.R")) #creates a table but with percentages
source(here::here("functions", "spround.R")) #combines round and sprintf
```


```{r prep_data, include = FALSE}
# import data
df <- import(here::here("data", "dataSPSS.sav"), setclass = "tibble") %>%
  janitor::clean_names()

# characterize all columns except for age and books1 (the spss labels were causing the numeric values to be recorded as NAs for those columns)
df %<>%
  mutate_at(vars(-age, -books1), characterize)

#switch 99 ages with refused
df %<>%
  mutate(age = replace(age, age == 99, NA))

# select only variables of interest
df_td <- df %>% 
  select(-comp, 
         -state:-qs1,
         -intmob,
         -home4nw:-device1d,
         -web1f:-web1h, #dropped because we don't have frequency values
         -pial5a:-pial5d,
         -pial11a:-pial11_igbm,
         -marital:-racem4,
         -birth_hisp,
         -partyln:-cellweight) %>%
  # parse date for interview date column
  mutate(int_date = ymd(int_date)) %>% 
  # remove participants who do not occasionally use the internet or email
  filter(eminuse == "Yes") %>%
  select(-eminuse)
  
# over-gather the sns_use and sns_freq_use columns, and spread them back out
df_td %<>%
  gather(key = "websites", value = "value", starts_with("sns"), starts_with("web")) %>%
  separate(websites, into = c("temp", "website"), sep = "[[:digit:]]") %>%
  spread(key = "temp", value = "value")

# change "no, do not do this" in the sns_use column to "Rarely if ever" in the sns_freq_use columns
df_td[which(df_td[, "web"] == "No, do not do this"), "sns"] <- "Rarely if ever"

#drop now unneeded sns_use column
df_td %<>%
  select(-web) %>% 
  #rename the values in the website column
  mutate(website = recode(website, a = "Twitter",
                                   b = "Instagram",
                                   c = "Facebook",
                                   d = "Snapchat",
                                   e = "YouTube")) %>% 
  #rename poorly named columns for sanity
  rename(id = respid,
         date = int_date,
         int_use_freq = intfreq,
         int_good_society = pial11,
         int_good_self = pial12,
         total_books_read = books1,
         books_print = books2a,
         books_audio = books2b,
         books_elect = books2c,
         race = racecmb,
         income = inc,
         sns_freq_use = sns,
         sns = website) %>% 
#convert factors to factors
  mutate(books_print = factor(books_print),
         books_audio = factor(books_audio),
         books_elect = factor(books_elect),
         sex = factor(sex),
         race = factor(race),
         party = factor(party),
         sns = factor(sns),
         int_good_society = factor(int_good_society),
         int_good_self = factor(int_good_self),
         int_use_freq = factor(int_use_freq),
         sns_freq_use = factor(sns_freq_use)) %>% 
  mutate(int_good_self    = fct_recode(int_good_self,
                                       "Bad" = "Bad thing",
                                       "Good" = "Good thing",
                                       "Some of both" = "(VOL) Some of both",
                                       "Other" = "(VOL) Don't know",
                                       "Other" = "(VOL) Refused"),
         int_good_society = fct_recode(int_good_society,
                                       "Bad" = "Bad thing",
                                       "Good" = "Good thing",
                                       "Some of both" = "(VOL) Some of both",
                                       "Other" = "(VOL) Don't know",
                                       "Other" = "(VOL) Refused"),
         party            = fct_recode(party,
                                       "Other" = "(VOL) Other party",
                                       "Other" = "(VOL) Don't know",
                                       "Other" = "(VOL) No preference",
                                       "Refused" = "(VOL) Refused"),
         race             = fct_recode(race,
                                       "Asian" = "Asian or Asian-American",
                                       "Black" = "Black or African-American",
                                       "Other" = "Or some other race",
                                       "Mixed" = "Mixed Race")) %>% 
  mutate(int_good_society = factor(int_good_society, 
                                   levels = c("Other", 
                                               "Bad", 
                                               "Some of both", 
                                               "Good")),
         int_good_self    = factor(int_good_self, 
                                   levels = c("Other", 
                                              "Bad", 
                                              "Some of both", 
                                              "Good")),
         int_use_freq     = factor(int_use_freq, 
                                   levels = c("(VOL) Don't know", 
                                              "Less often?", 
                                              "Several times a week, OR", 
                                              "About once a day", 
                                              "Several times a day", 
                                              "Almost constantly")),
         sns_freq_use     = factor(sns_freq_use,
                                   levels = c("(VOL) Don't know",
                                              "Rarely if ever",
                                              "Less often",
                                              "Every few weeks",
                                              "A few times a week", 
                                              "About once a day", 
                                              "Several times a day")))


```

Social media sites are commonly defined as an internet-based service allowing for the creation and broadcast of user-generated information [@Boyd2008; @Kaplan2010; @Obar2015]. @Obar2015 emphasize the user-generated aspect of this definition, arguing that this content is the lifeblood of social media. Although that may sound hyperbolic, it logically follows that if a site is created with the express purpose of providing user-generated content, it must have user-generated content to function as intended. By way of illustration, without videos created by users, YouTube, a social media site that allows its users to upload and share videos, would fail to serve its primary purpose. Netflix, a site that allows users to only stream videos, does not require user-generated content, as it does not serve user-generated content, and, by extension is not a social media site. Beyond the functional aspects of social media sites, the user-generated focus also highlights the importance of individual differences in the user-service relationship, as users invariably have characteristics that affect how they consume and generate content.

# Method

The data for the current study was collected by the @Pew.

## Participants

`r capitalize(.numbers2words(nrow(df)))` people were surveyed by telephone (`r .spround(.perble(df$sample)["Percent", "Cell phone"])`% cell phone; `r .spround(.perble(df$sample)["Percent", "Landline"])`% landline) over a period of `r interval(min(df_td$date), max(df_td$date)) %/% days(1)` days in `r unique(months(df_td$date))` of `r unique(year(df_td$date))`. We excluded any participants who reported that they do not even occasionally use the internet or email (*n* = `r nrow(df) - length(unique(df_td$id))`). The resulting sample comprised `r length(unique(df_td$id))` people (`r .spround(.perble(df_td$sex)["Percent", "Female"])`% female). Ages ranged from `r min(df_td$age, na.rm = TRUE)` to `r max(df_td$age, na.rm = TRUE)` (*M* age = `r .spround(mean(df_td$age, na.rm = TRUE))`; *SD* age = `r .spround(sd(df_td$age, na.rm = TRUE))`)\footnote{Note that the descriptive statistics for age are slightly lower than reality. Ages 97 and older were recorded as simply 97 in the data.}. Concerning race, `r .spround(.perble(df_td$race)["Percent", "White"])`% identified as white, `r .spround(.perble(df_td$race)["Percent", "Black"])`% identified as black, `r .spround(.perble(df_td$race)["Percent", "Asian"])`% identified as Asian, `r .spround(.perble(df_td$race)["Percent", "Mixed"])`% identified as mixed race, and `r .spround(.perble(df_td$race)["Percent", "Don't know/Refused (VOL.)"] + .perble(df_td$race)["Percent", "Other"])`% refused to answer or reported being from some other race.  

## Materials and Procedure

Research personnel were instructed to read from a script while interviewing each participant. For landline users, the script began as follows:

"Hello, I am _____ calling on behalf of the Pew Research Center. We are conducting a telephone opinion survey about some important issues today and we would like to include your household. May I please speak with the YOUNGEST [RANDOMIZE: (MALE / FEMALE)], age 18 or older, who is now at home? [IF NO MALE/FEMALE, ASK: May I please speak with the YOUNGEST (FEMALE / MALE), age 18 or older, who is now at home?]"

For cell phone users, the script was slightly different:

"Hello, I am _____ calling on behalf of the Pew Research Center. We are conducting a telephone opinion survey about some important issues today. I know I am calling you on a cell phone. If you would like to be reimbursed for your cell phone minutes, we will pay all eligible respondents $5 for participating in this survey. This is NOT a sales call."

Once participants passed initial screening (e.g., 18 years of age or older) and provided verbal consent to the interview, they were asked a series of questions pertaining to internet use  (e.g., "How often do you use the internet?"; options ranged from 1 = "Almost Constantly" to 5 = "Less Often"), social media use (e.g., "Do you use any of the following social media sites online or on your cell phone: Twitter, Instagram, Facebook, Snapchat, YouTube, WhatsApp, Interest, and LinkedIn?), as well as perceptions of social media's influence on the self and society (e.g., "When you add up all the advantages and disadvantages of the internet, would you say the internet has mostly been a good thing or a bad thing for society?"; options included: "Good thing", "bad thing", "Some of Both", and "Don't Know"). Participants were also asked about reading habits (e.g., "During the past 12 months, how many books (print, electroninc, and audiobooks) did you read either all or part of the way through?") and reading format preferences (e.g., "Thinking about all of the books you have read iin the past 12 months, were any of those printed books, audiobooks, or E-books?"). The interview ended with a series of demographic questions assessing variables including participant sex, age, race, marrital status, education, current employment status, income, and political affiliation.

## Data analysis
We used `r cite_r("r-references.bib")` for all our analyses.

# Results

First, we sought to examine how frequency of social media use might vary as a function of sex, age, social media site, and the interaction between these variables. We ran iterative comparisons of XXX linear mixed-effects models predicting frequency of social media use from age, social media site, sex, and the interactions among these variables. Our first model included only the random effects. Specifically, we suspected that participants may have certain response style in evaluating their frequency of social media use. We entered the subject as a random intercept to account for interdependence in the participants ratings. Although in many cases the scenario or context (i.e., social media site) would be entered as a random slope, we do not intend to generalize beyond these sites. 

Our second model added gender, followed by age in our third model. The fourth model included the social media site in question. The fifth through seventh models added (1) the interaction between sex and age, (2) the interaction between sex and social media site, and (3) the interaction between age and social media site. 

```{r df_f_lmer_desless, include = FALSE, cache = TRUE, autodep = TRUE}
#remove unknowns and "rarely if ever and change sns_freq_use to numeric
df_td_lmer <- df_td %>%
  filter(sns_freq_use != "(VOL) Don't know",
         #rarely if ever was leading to blocky residuals
         sns_freq_use != "Rarely if ever",
         !is.na(sns_freq_use),
         !is.na(age)) %>%
  mutate(sns_freq_use = as.numeric(sns_freq_use))

#NULL
model_null <- lmer(sns_freq_use ~ (1 | id), data = df_td_lmer, REML = FALSE)

#sex
model_1    <- lmer(sns_freq_use ~ sex + 
                                  (1 | id), data = df_td_lmer, REML = FALSE)

#age
model_2    <- lmer(sns_freq_use ~ sex + 
                                  age +
                                  (1 | id), data = df_td_lmer, REML = FALSE)

#sns
model_3    <- lmer(sns_freq_use ~ sex + 
                                  age +
                                  sns +
                                  (1 | id), data = df_td_lmer, REML = FALSE)


#sex x age
model_4    <- lmer(sns_freq_use ~ sex + 
                                  age +
                                  sns +
                                  sex * age +
                                  (1 | id), data = df_td_lmer, REML = FALSE)

#sex x sns
model_5    <- lmer(sns_freq_use ~ sex + 
                                  age +
                                  sns +
                                  sex * age +
                                  sex * sns +
                                  (1 | id), data = df_td_lmer, REML = FALSE)

#age x sns
model_6    <- lmer(sns_freq_use ~ sex + 
                                  age +
                                  sns +
                                  sex * age +
                                  sex * sns +
                                  age * sns +
                                  (1 | id), data = df_td_lmer, REML = FALSE)

#compare models
(models_compared <- anova(model_null,
                          model_1,
                          model_2,
                          model_3,
                          model_4,
                          model_5,
                          model_6))

#compare model without random effects to that with random effects
model_wo <- lm(sns_freq_use ~ sex + 
                              age +
                              sns +
                              sex * age +
                              sex * sns +
                              age * sns, data = df_td_lmer)

(wo_compared <- anova(model_6, model_wo))

###plot residuals
plot(resid(model_6))
qqnorm(resid(model_6))
qqline(resid(model_6))

###check out VIF
(model_vif_desless <- vif(model_3))

#check out full model results
(sum_model_6 <- summary(model_6))

#check out the variances
model_var <- print(VarCorr(model_6), comp = "Variance")
(model_var <- data.frame(model_var)[, c("grp", "vcov")])

#check out contasts
emm_options(pbkrtest.limit = nrow(df_td_lmer))
emms_results <- emmeans(model_6, ~ sns | sex)
(emms_contrast <- contrast(emms_results, interaction = "pairwise"))
```




All of the predictors together accounted for 33% of the variability in frequency of social media use, *F*(19, 8136) = 206.9, *p* < .001. Figure 1 reveals that younger people used social media more frequently than older people, *F*(1, 8136) = 1151.27, *p* < .001. People also tended to use Facebook the most, followed by YouTube, Instagram, Snapchat, and Twitter, *F*(4, 8136) =611.65, *p* < .001. Critically, though, the effect of age on frequency of social media use varied as a function of social media site, *F*(4, 8136) = 40.42, *p* < .001. That is, age-related differences in frequency of social media use emerged primarily for Instagram (*β* = -0.26, *p* < .001), Snapchat (*β* = -0.31, *p* < .001), and YouTube (*β* = -.13, *p* = .01).

```{r ash_analyses_viz, include = FALSE}

plot_data_ash <- df_td %>% 
  select(age, sex, party, sns, sns_freq_use, int_good_society, int_good_self, int_use_freq) %>%
  mutate(int_good_self = as.numeric(int_good_self),
         int_good_society = as.numeric(int_good_society),
         int_use_freq = as.numeric(int_use_freq),
         sns_freq_use = as.numeric(sns_freq_use)) %>%
  filter(party != "Refused",
         sns_freq_use != "<NA>",
         sns_freq_use != "(VOL) Don't know")

#Examining frequency of social media use as a function of age and social media site

fig1a <- ggplot(transform(plot_data_ash,
                          sns = factor(sns,levels = c("Facebook", "YouTube", "Instagram", "Snapchat", "Twitter")))) +
  geom_smooth(aes(x = age, y = sns_freq_use, group = sns, colour = sns), method = "lm", se = TRUE, lwd = 1.5) +
  scale_colour_viridis_d() +
  theme_bw() +
  labs(title = "Interaction between age and social media site",
       x = "Age", 
       y = "Frequency of Social Media Use",
       colour = "Social Media Site")

plot_sns <- plot_data_ash %>%
  group_by(sns) %>%
  summarise(freq_sns_mean = mean(sns_freq_use)) 

fig1b <- ggplot(transform(plot_sns,
                          sns = factor(sns,levels = c("Facebook", "YouTube", "Instagram", "Snapchat", "Twitter")))) +
    geom_col(aes(x = sns, y = freq_sns_mean, fill = sns)) +
    scale_fill_viridis_d() +
    theme_bw() +
    theme(legend.position = "") +
    labs(title = "Main effect of social media site",
        x = "Social Media Site",
        y = "Frequency of Social Media Use",
        colour = "")

fig1c <- plot_data_ash %>%
  group_by(age) %>%
  summarise(freq_sns_mean = mean(sns_freq_use, fill = age)) %>%
  ggplot(aes(x = age, y = freq_sns_mean)) +
    geom_point(alpha = 0.9, fill = "turquoise3", color = "turquoise4", size = 2.5) +
    geom_smooth(color = "grey", method = lm, se = FALSE) +
    theme_bw() +
    theme(legend.position = "") +
    labs(title = "Main effect of age",
        x = "Age",
        y = "Frequency of Social Media Use")

fig1d <- plot_grid(fig1b, fig1c, labels = c("B", "C"), align = "h", ncol = 2)

Figure1 <- plot_grid(fig1a, fig1d, labels = c("A", ""), align = "v", axis = "t", nrow = 2)

Figure1

```

Of note, frequency of social media use also varied by sex, *F*(1, 8136) = 28.50, *p* < .001. Figure 2(c) reveals that, on average, females tended to report higher frequency of social media use than did males. Moreover, sex interacted with age, *F*(1, 8136) = 19.79, *p* < .001, as well as social media site, *F*(1, 8136) = 40.42, *p* < .001, in predicting frequency of social media use. Figure 2(b) shows that the interaction between sex and social media site is primarily driven by the finding that women reported higher Facebook use than men, and men reported higher YouTube use than women. 
While the three-way interaction between sex, age, and social media site approached significance (*p* = .10), an examination of Figure 2(a) suggests a possible age x social media site interaction for exclusively females, not males. Excluding males from the analysis indeed revealed a significant interaction, *F*(4, 3662) = 22.93, *p* < .001, suggesting that—for females—the largest age-related differences emerged for Facebook, Instagram, and Snapchat. 

```{r ash_analyses_viz2, include = FALSE}

#Examing the potential influence of sex on the aforementioned effects

fig2a <- ggplot(transform(plot_data_ash, 
                 sns = factor(sns,levels = c("Facebook", "YouTube", "Instagram", "Snapchat", "Twitter")))) +
  geom_smooth(aes(x = age, y = sns_freq_use, group = sex, colour = sex), method = "lm", se = TRUE, lwd = 2) +
  scale_color_manual(values = c("turquoise4", "darkorchid4")) +
  geom_jitter(aes(x = age, y = sns_freq_use, colour = sex), alpha = 0.2) +
  facet_wrap(~sns, nrow = 1) +
  theme_bw() +
  labs(title = "Interaction between sex, age, and social media site",
       x = "Age", 
       y = "Frequency of social media use",
       colour = "Sex")

plot_snsxsex <- plot_data_ash %>%
  group_by(sex, sns) %>%
  summarise(freq_sns_mean = mean(sns_freq_use))

fig2b <- ggplot(transform(plot_snsxsex,
                                 sns = factor(sns,levels = c("Facebook", "YouTube", "Instagram", "Snapchat", "Twitter")))) +
    geom_col(aes(x = sex, y = freq_sns_mean, group = sex, fill = sex)) +
    scale_fill_manual(values = c("turquoise4", "darkorchid4")) +
    facet_wrap(~sns, nrow = 1) +
    theme_bw() +
    theme(legend.position = "") +
    labs(title = "Interaction between sex and social media site",
       x = "Sex", 
       y = "Frequency of social media use",
       colour = "Sex")

fig2c <- plot_data_ash %>%
  ggplot(aes(x = sex, y = sns_freq_use)) +
    geom_boxplot(aes(group = sex, fill = sex)) +
    scale_fill_manual(values = c("turquoise4", "darkorchid4")) +
    theme_bw() +
    theme(legend.position = "") +
    labs(title = "Main effect of sex",
       x = "Sex", 
       y = "Frequency of social media use")

fig2d <- plot_grid(fig2b, fig2c, labels = c("B", "C"), align = "h", ncol = 2)

Figure2 <- plot_grid(fig2a, fig2d, labels = c("A", ""), align = "v", axis = "t", nrow = 2)

Figure2

#Regressions

##########################################################################
#Cam, please fix my regression by creating a linear mixed effect model :)
##########################################################################

sns_model <- lm(sns_freq_use ~  age * sex * sns, data = plot_data_ash)

anova(sns_model)
#summary(sns_model)
#std_beta(sns_model)

female_sns_model <- plot_data_ash %>%
  filter(sex == "Female")

female_sns_model <- lm(sns_freq_use ~ age * sns, female_sns_model)

#anova(female_sns_model)
#summary(female_sns_model)
#std_beta(female_sns_model)

```


```{r books_analyses, include = FALSE, warning = FALSE}
#####################################
### Tidying Data for Analyses:

# Subset the original data and tidy for plotting, added age_group variable and recoded
plot_data <- df_td %>% 
  select(id, age, total_books_read, books_print, books_audio, books_elect) %>% 
  filter(!duplicated(id) & !is.na(age)) %>% # Remove duplicate id's so we have one observation per subject
  gather(book_format, yn, -age, -total_books_read, -id) %>% 
  separate(book_format, c("dis", "book_format"), sep = "_", convert = TRUE) %>% 
  select(-dis) %>%
  mutate(yn = replace(yn, str_detect(yn, 'VOL'), NA)) %>% 
  mutate(book_format = factor(book_format),
         yn = factor(yn),
         age_group = factor(findInterval(age, seq(10, 100, by = 10)))) %>% 
  mutate(age_group = recode(age_group, "1" = "18-19",
                            "2" = "20-29",
                            "3" = "30-39",
                            "4" = "40-49",
                            "5" = "50-59",
                            "6" = "60-69",
                            "7" = "70-79",
                            "8" = "80-89",
                            "9" = "90-99"))

#  Build new format column that exclusively represents one type of media format: exclusively print, audiobook, or electronic, plus a mixed-media option for poeple who use more than one type. 
subj <- unique(plot_data$id)
plot_data$new_format <- NA

# Loop through subjects to populate new_format column which will later replace the book_format column.
for (i in 1:length(subj)) {
  foo <- plot_data[plot_data$id == subj[i],]
  if (length(which(foo$yn == "Yes")) == 1) {
    plot_data$new_format[plot_data$id == subj[i]] <- as.character(rep(foo$book_format[foo$yn == "Yes"], 3))
  } else if (length(which(foo$yn == "Yes")) >= 2) {
    plot_data$new_format[plot_data$id == subj[i]] <- as.character(rep("mixed media", 3))
  }
}

# Replace the book_format column with the new_format column, remove redundant columns (new_format and yn)
plot_data %<>%
  select(-book_format) %>%
  mutate(book_format = new_format) %>%
  select(-new_format, -yn) %>%
  filter(!duplicated(id)) # remove duplicate rows

#####################################
###  Reading and Age Visualization:

# Pick color palette for plot
pal <- jcolors("pal10")

# Bar Chart: looking at average books read across age.
bar_plot <- plot_data %>%
  group_by(age_group) %>% 
  dplyr::summarize(mean_books = mean(total_books_read),
                   se_books = plotrix::std.error(total_books_read, na.rm = TRUE)) %>% 
  ggplot(aes(x = age_group, y = mean_books, fill = age_group)) + 
  geom_col() +
  geom_linerange(aes(ymin = mean_books - se_books, ymax = mean_books + se_books), 
                width = .2, position = position_dodge(.9)) +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, 25)) +
  scale_fill_manual(values = pal) + 
  theme(legend.position = "none") +
  labs(y = "Average Books Read",
       x = "Ages",
       title = "Books Read by Age",
       subtitle = "Books read in the past year.") +
  theme(plot.subtitle = element_text(size = 17, hjust = 0, face = "italic", color = "black"),
        plot.title = element_text(size = 25, hjust = 0),
        axis.title.x = element_text(size = 20), 
        axis.title.y = element_text(size = 20),
        axis.text = element_text(size = 15))

bar_plot

# Bar Chart: looking at average books read by media format
pal2 <- wes_palette("Darjeeling1")

bar_plot2 <- plot_data %>% 
  filter(!is.na(book_format)) %>% 
  group_by(book_format) %>% 
  dplyr::summarize(mean_books = mean(total_books_read),
                   se_books = plotrix::std.error(total_books_read, na.rm = TRUE)) %>% 
  ggplot(aes(x = reorder(book_format, -mean_books), y = mean_books, fill = book_format)) + 
  geom_col() +
  geom_linerange(aes(ymin = mean_books - se_books, ymax = mean_books + se_books), 
                width = .2, position = position_dodge(.9)) +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, 28)) +
  scale_fill_manual(values = pal2) +
  theme(legend.position = "none") +
  labs(y = "Average Books Read",
       x = "Media Format",
       title = "Average Books Read by Format",
       subtitle = "Average books read in past year.") +
  theme(plot.subtitle = element_text(size = 17, 
                                     hjust = 0, 
                                     face = "italic", 
                                     color = "black"),
        plot.title = element_text(size = 25, hjust = 0),
        axis.text.x = element_text(angle = 0, vjust = .5)) 

bar_plot2

# Bar Chart: looking at average books read, by age group and media format
media_labels <- c(`audio` = "Audio",
                    `elect` = "Electronic",
                    `print` = "Print",
                    `mixed media` = "Mixed Media") # Facet Labels

bar_plot3 <- plot_data %>%
  filter(!is.na(book_format)) %>% 
  group_by(age_group, book_format) %>% 
  dplyr::summarize(mean_books = mean(total_books_read),
                   se_books = plotrix::std.error(total_books_read, na.rm = TRUE)) %>% 
  ggplot(aes(x = age_group, y = mean_books, fill = book_format)) + 
  geom_col(position = position_dodge(.9)) +
  facet_wrap(~book_format, labeller = as_labeller(media_labels)) +
  scale_fill_manual(values = pal2) + 
  theme(legend.position = "right") +
  labs(y = "Average Books Read",
       x = "Age",
       title = "Relationship Between Age and Books Read by Media Format",
       subtitle = "Books read in the past year.") +
  theme(plot.subtitle = element_text(size = 17, hjust = 0, face = "italic", color = "black"),
        plot.title = element_text(size = 25, hjust = 0),
        axis.title.x = element_text(size = 20), 
        axis.title.y = element_text(size = 20),
        axis.text = element_text(size = 15),
        axis.text.x = element_text(angle = 90, vjust = .5))

bar_plot3

#####################################
###  Reading and Age Analysis:
reg_data <- plot_data %>% 
  filter(!is.na(book_format)) %>% 
  group_by(age, book_format) %>% 
  dplyr::summarize(mean_books = mean(total_books_read))
  
# Fit the model
model <- lm(mean_books ~ age * book_format, data = reg_data)

#summary(model)
#anova(model)

```
 

# Discussion


\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
